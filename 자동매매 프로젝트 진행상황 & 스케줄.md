
## 1. TradingView 전략 작성 및 백테스트 (상시 반복)

### 1-1) 전략 작성
- 파인스크립트 사용 (현재 v7.2 기준)
- 전략 예시: RSI, EMA, 캔들 패턴, 볼린저 밴드 등
- `strategy.entry()`로 진입 조건 설정

### 1-2) 알림 설정
- 전략 조건 만족 시 Alert 생성
- Alert 유형: Webhook URL
- Webhook 메시지 예시:
```json
{
  "side": "buy",
  "quantity": "0.05"
}```

## 2. Flask 서버 구축 ngrok로 연결 

### 2-1) 구조 이해

## 🚀 1️⃣ Flask 서버는 “웹서버”야

- Flask는 **당신의 컴퓨터 안에서 돌아가는 미니 웹서버**입니다.
    
- 즉, 인터넷에서 들어오는 요청을 받아 처리하는 “문지기” 같은 역할이에요.

	누군가 [http://127.0.0.1:5000/webhook](http://127.0.0.1:5000/webhook) 으로 요청을 보내면 Flask가 받는다.

결론) “로컬 서버가 켜졌어요! 하지만 외부에서는 접근할 수 없어요.”

## 💻 2️⃣ “127.0.0.1:5000”은 **내 컴퓨터 안에서만 접근 가능**

- `127.0.0.1` 또는 `localhost` 는 “내 컴퓨터 내부 주소”입니다.
    
- 즉, Flask가 띄운 서버는 **현재 네 컴퓨터 안에서만 접근 가능**하고,  
    외부(TradingView, Binance 등)에서는 **절대 접근할 수 없음.**


ngrok 역할)
“외부에서 접근할 수 있는 URL(예: https://abcd.ngrok.io)을 만들고,  
들어오는 요청을 네 컴퓨터의 [http://127.0.0.1:5000](http://127.0.0.1:5000) 으로 **터널링** 시켜주는 것.”
	nginx)
	TradingView (인터넷)
	   ↓
	https://abcd.ngrok.io/webhook  ← ngrok가 만든 공개 주소
	   ↓
	http://127.0.0.1:5000/webhook  ← Flask 서버 (당신의 로컬)


### 2-2) ngrok 구축



### 2-3)실행순서

1️⃣ **Flask 서버 실행**

`python webhook_server.py`

→ “Running on [http://127.0.0.1:5000”](http://127.0.0.1:5000%E2%80%9D) 이라고 뜸  
→ 터미널 그대로 둠 (입력 안 함)

2️⃣ **새 터미널 창 열기**

`ngrok http 5000`

3️⃣ **ngrok가 만든 주소 확인**  
예시:

`Forwarding  https://abcd1234.ngrok.io -> http://localhost:5000`

4️⃣ **TradingView에서 Webhook URL 입력**

`https://abcd1234.ngrok.io/webhook`

5️⃣ **TradingView에서 Alert 발생 시**  
→ ngrok가 요청을 Flask 서버로 전달  
→ Flask가 `execute_trade()` 실행  
→ 콘솔에 “🚀 Executing BUY for BTCUSDT...” 출력

---

## 🧩 6️⃣ 구조 이해 요약 그림

 `┌────────────────────┐  │ TradingView (Alert)│  └──────┬─────────────┘         │ Webhook POST         ▼  ┌────────────────────┐  │ ngrok (https tunnel)│  └──────┬─────────────┘         │ 포워딩         ▼  ┌────────────────────┐  │ Flask server (localhost:5000)│  │ → /webhook route 실행       │  └────────────────────┘         │         ▼  ┌────────────────────┐  │ trader.py (execute_trade)│  │ → 거래 API 실행         │  └────────────────────┘`

| 단계                                              | 역할                           |
| ----------------------------------------------- | ---------------------------- |
| Flask                                           | 로컬 서버. webhook 요청을 처리        |
| ngrok                                           | 외부 요청을 Flask로 연결             |
| 127.0.0.1                                       | 내 컴퓨터 안의 Flask 주소 (외부 접근 불가) |
| [https://abcd.ngrok.io](https://abcd.ngrok.io/) | 외부 공개 주소 (TradingView에서 사용)  |
| 터미널 입력 불가                                       | 정상. 서버가 대기 중이기 때문            |

# 📅 2025-10-25 (토)

## 🌞 오늘의 주요 작업
- [x] ngrok 실행 오류 해결  
- [x] 환경 변수(Path) 재설정 (`C:\Tools\ngrok`)  
- [x] Windows 64-bit용 ngrok 재설치  
- [x] ngrok authtoken 등록 완료  
- [x] Flask(5000) + ngrok 연결 성공  
- [x] curl로 Webhook POST 요청 테스트 성공  

---

## 🧠 오늘 배운 점 / 깨달은 점
- CMD와 PyCharm 터미널은 환경변수 반영 시점이 다르다 → CMD에서 테스트가 확실함  
- ngrok이 “다른 시스템용 이미지 파일” 오류를 낼 때는 아키텍처(64bit/ARM)를 확인해야 함  
- Flask 서버가 꺼진 상태에선 ngrok이 ERR_NGROK_8012 오류를 낸다  
- CMD에서 `\`로 줄바꿈하면 안 된다 (`^` 또는 한 줄로 입력해야 함)  

---

## ⚙️ 현재 시스템 상태
- **ngrok 버전:** 3.32.0  
- **상태:** Online (region: jp)  
- **Forwarding:**  
  `https://semilucent-teri-unleaved.ngrok-free.dev → http://localhost:5000`  
- **Flask Webhook:** 정상 수신 중  
- **Web Interface:** [http://127.0.0.1:4040](http://127.0.0.1:4040)

---

## ⚠️ 오늘 겪은 문제와 해결
| 문제 | 원인 | 해결 |
|------|------|------|
| ngrok 인식 안 됨 | PATH 누락 | `C:\Tools\ngrok` 추가 |
| 이미지 파일 오류 | 잘못된 아키텍처 다운로드 | 64-bit 버전 재설치 |
| ERR_NGROK_8012 | Flask 미실행 | Flask 켜고 ngrok 연결 |
| Bad hostname (curl) | CMD 줄바꿈 오류 | 한 줄 명령으로 실행 |

---

## 🌙 하루 정리
- ngrok & Flask 연결 환경 완성 🎉  
- 외부 Webhook 테스트 성공  
- 다음 목표: **TradingView → Flask Webhook → 자동매매 실행 로직** 연동  

🕛 *오늘은 충분히 수고했음. 내일은 코드 로직 연결 파트로 가자.*
